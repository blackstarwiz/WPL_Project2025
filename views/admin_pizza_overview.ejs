<%- include('partials/header') %>
<main>
    <h1>PIZZA</h1>

    <h2>Toevoegen</h2>

    <form id="addPizzaForm">

        <label>Naam</label>
        <input type="text" name="name" id="addName">

        <label>Prijs</label>
        <input type="text" name="price" id="addPrice">

        <label>Afbeelding upload (ImgBB)</label>
        <input type="file" id="addImage" accept="image/*">
        <button type="button" onclick="uploadAddImage()">Upload</button>

        <div id="addImagePreview"></div>
        <div id="addImageUrl"></div>

        <button type="submit">Toevoegen</button>

    </form>

    <hr>

    <h2>Bewerken</h2>

    <form id="editPizzaForm">

        <label>Naam</label>
        <select id="editSelect" name="pizza">
            <option value="">selecteer</option>
        </select>

        <label>Prijs</label>
        <input type="text" name="price" id="editPrice">

        <label>Afbeelding upload (ImgBB)</label>
        <input type="file" id="editImage" accept="image/*">
        <button type="button" onclick="uploadEditImage()">Upload</button>

        <div id="editImagePreview"></div>
        <div id="editImageUrl"></div>

        <button type="button">Verwijderen</button>
        <button type="submit">Bewerken</button>

    </form>

    <script>

        // reusable upload function
        async function uploadToImgBB(file, previewId, urlId) {
            const form = new FormData();
            form.append('key', '0100d0335817b15fe19145925a6d39ce');
            form.append('image', file);

            const response = await fetch('https://api.imgbb.com/1/upload', {
                method: 'POST',
                body: form
            });

            const data = await response.json();
            if (!data.success) return;

            const url = data.data.url;

            document.getElementById(previewId).innerHTML =
                '<img src="' + url + '" width="150">';

            document.getElementById(urlId).textContent = url;
        }

        // add form upload
        async function uploadAddImage() {
            const file = document.getElementById('addImage').files[0];
            if (!file) return;
            await uploadToImgBB(file, 'addImagePreview', 'addImageUrl');
        }

        // edit form upload
        async function uploadEditImage() {
            const file = document.getElementById('editImage').files[0];
            if (!file) return;
            await uploadToImgBB(file, 'editImagePreview', 'editImageUrl');
        }

    </script>

</main>

<%- include('partials/footer') %>